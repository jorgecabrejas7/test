FROM node:16-alpine

WORKDIR /app

COPY package.json .
COPY package-lock.json .


RUN npm install

COPY  . .

# Define ARG variables
ARG NODE_ENV
ARG HTTPS
ARG NEXT_PUBLIC_API_URL
ARG WDS_SOCKET_PORT
ARG NEXTAUTH_URL
ARG NEXTAUTH_SECRET
ARG BACK_API_URL
ARG BACK_API_AUTH_URL
ARG STRIPE_PUBLIC_KEY

# Set ENV variables using ARG values
ENV NODE_ENV=$NODE_ENV
ENV HTTPS=$HTTPS
ENV NEXT_PUBLIC_API_URL=$NEXT_PUBLIC_API_URL
ENV WDS_SOCKET_PORT=$WDS_SOCKET_PORT
ENV NEXTAUTH_URL=$NEXTAUTH_URL
ENV NEXTAUTH_SECRET=$NEXTAUTH_SECRET
ENV BACK_API_URL=$BACK_API_URL
ENV BACK_API_AUTH_URL=$BACK_API_AUTH_URL
ENV STRIPE_PUBLIC_KEY=$STRIPE_PUBLIC_KEY

RUN npm run build
CMD npm start
